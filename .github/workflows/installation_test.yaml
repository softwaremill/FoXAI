name: Installation test

on:
  workflow_dispatch:
    inputs:
      cuda_version:
        description: "Select CUDA version"
        required: true
        default: "11.6.2"
        type: choice
        options:
          - "11.0.3"
          - "11.2.2"
          - "11.4.3"
          - "11.6.2"
          - "11.8.0"
          - "12.0.0"
      python_version:
        description: "Select Python version"
        required: true
        default: "3.7"
        type: choice
        options:
          - "3.7"
          - "3.8"
          - "3.9"
          - "3.10"
          - "3.11"

env:
  POETRY_VERSION: "1.4.2"
jobs:
  foxai:
    name: Launch GKE Pod with GPU
    runs-on: gpu-t4-pool
    container:
      image: nvidia/cuda:${{ inputs.cuda_version }}-runtime-ubuntu20.04 # https://gitlab.com/nvidia/container-images/cuda/-/tree/master/dist
      options: --cpus 2 --memory-reservation 8g --gpus all
      volumes:
        - /usr/local/nvidia/lib64:/usr/local/nvidia/lib64
    steps:
      - name: Check out repository
        uses: actions/checkout@v3
      - name: Install system libs
        run: |
          apt-get update -y
          apt-get install -y libglib2.0-0 libx11-dev libxext-dev
      - uses: "./.github/actions/build-module"
        env:
          PYTHON_VERSION: ${{ inputs.python_version }}
        with:
          moduleName: "src"
